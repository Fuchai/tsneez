!function(t,e,n,o,r,i,a){function s(){var t=v();if(null!==t){var e=b.selectAll(".u").data(f.words).attr("transform",function(e,n){return e.rotate?e.rotate=e.rotate:e.rotate=10*(Math.random()-.5),"translate("+(200*t.get(n,0)*D+P+400)+","+(200*t.get(n,1)*D+j+400)+")rotate("+e.rotate+")"});e.selectAll("rect").style("fill-opacity",function(t){return t.init===!0&&M>0?Math.max(Math.min(.9-Math.sqrt(.09*M),.9),0):.9}),M--}}function c(){var t=e(".viewport").width(),n=600;b.attr("width",t).attr("height",n)}function l(){P=n.event.translate[0],j=n.event.translate[1],D=n.event.scale}function u(){var t=b.selectAll(".b").data(f.words,function(t){return t.str}).enter().append("g").attr("class","u");t.append("rect").attr("width",function(t){return 8*t.str.length+10}).attr("height",20).attr("rx",5).attr("ry",5).style("fill",function(t){return a({luminosity:"light",seed:t.str})}),t.append("text").attr("text-anchor","middle").attr("x",function(t){return 4*t.str.length+5}).attr("y",10).attr("alignment-baseline","central").attr("fill","#333").text(function(t){return t.str})}function d(){var t=n.select(".viewport");b=t.append("svg"),u(),N(b),n.select(window).on("resize",c),c()}function w(){E&&console.time("step"),g(),E&&console.timeEnd("step");Math.round(x/(o.now()-T)*1e3);s(),10===x&&h&&window.console&&window.console.profile&&console.profileEnd(),window.requestAnimationFrame(w)}var f,p,v,m,g,h=!1,E=!1,S="tsneez",y="/t-sneez/data/wordvecs50dtop1000.json",z=800,x=0,A=Math.max(z/100,3);switch(S){case"tsneez":p=new t.TSNEEZ({theta:.5,perplexity:A,randomProjectionInitialize:!0}),m=function(t){p.initData(t)},g=function(){return x++,p.step()},v=function(){return p.Y};break;case"karpathy":p=new r.tSNE({perplexity:A}),m=function(t){p.initDataRaw(t)},g=function(){return x++,p.step()},v=function(){var t=p.getSolution();return{get:function(e,n){return t[e][n]}}};break;case"scienceai":var k=new Worker("/t-sneez/javascripts/scienceai-worker.js"),R=null,T=o.now();k.onmessage=function(t){var e=t.data;switch(e.type){case"PROGRESS_STATUS":break;case"PROGRESS_ITER":break;case"PROGRESS_DATA":var n=o.now();E===!0&&(null===R?console.log("initialization",n-T+"ms"):console.log("step",n-T+"ms")),R=e.data,T=o.now(),x++;break;case"STATUS":console.log("status",e.data);break;case"DONE":R=e.data}},m=function(t){k.postMessage({type:"INPUT_DATA",data:t}),k.postMessage({type:"RUN",data:{perplexity:30,earlyExaggeration:4,learningRate:10,nIter:1e3,metric:"euclidean"}})},g=function(){},v=function(){return null===R?{get:function(){return null}}:{get:function(t,e){return R[t][e]}}},E=!1}var b,M=0,N=n.behavior.zoom().scaleExtent([.05,10]).center([0,0]).on("zoom",l),P=0,j=0,D=1,T=o.now();e(window).load(function(){e.getJSON(y,function(t){t.words=t.words.map(function(t){return{str:t,init:!0}}),f={words:t.words.slice(0,z),vecs:t.vecs.slice(0,z)},h&&window.console&&window.console.profile&&console.profile("initialization"),E&&console.time("initialization"),m(f.vecs),E&&console.timeEnd("initialization"),h&&window.console&&window.console.profile&&console.profileEnd(),d(),h&&window.console&&window.console.profile&&console.profile("step"),window.requestAnimationFrame(w),e("#addPoints").click(function(){M=10,f.words=f.words.map(function(t){return t.init=!0,t});for(var e=0;e<10;e++){var o=t.words[z];o.init=!1,p.add(t.vecs[z]),f.words.push(o),z++}n.selectAll(".viewport > svg").remove(),d()})})})}(tsneez,$,d3,performance,tsnejs,TSNE,randomColor);