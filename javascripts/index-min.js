!function(t,n,e,o,r,i){function a(){var t=p.Y,n=f.selectAll(".u").data(u.words).attr("transform",function(n,e){return n.rotate?n.rotate=n.rotate:n.rotate=10*(Math.random()-.5),"translate("+(200*t.get(e,0)*x+h+400)+","+(200*t.get(e,1)*x+g+400)+")rotate("+n.rotate+")"});n.selectAll("rect").style("fill-opacity",function(t){return t.init===!0&&v>0?Math.min(.9-Math.sqrt(.009*v),.9):.9}),v--}function s(){var t=n(".viewport").width(),e=600;f.attr("width",t).attr("height",e)}function l(){var t=f.selectAll(".b").data(u.words,function(t){return t.str}).enter().append("g").attr("class","u");t.append("rect").attr("width",function(t){return 8*t.str.length+10}).attr("height",20).attr("rx",5).attr("ry",5).style("fill",function(t){return i({luminosity:"light",seed:t.str})}),t.append("text").attr("text-anchor","middle").attr("x",function(t){return 4*t.str.length+5}).attr("y",10).attr("alignment-baseline","central").attr("fill","#333").text(function(t){return t.str})}function c(){var t=e.select(".viewport");f=t.append("svg"),l(),m(f),e.select(window).on("resize",s),s()}function d(){h=e.event.translate[0],g=e.event.translate[1],x=e.event.scale}function w(){p.step();Math.round(p.iter/(o.now()-A)*1e3);a(),10===y&&E&&window.console&&window.console.profile&&console.profileEnd(),y++,requestAnimationFrame(w)}var u,f,p=new t.TSNE({theta:.8}),v=0,m=e.behavior.zoom().scaleExtent([.05,10]).center([0,0]).on("zoom",d),h=0,g=0,x=1,y=0,A=o.now(),E=!0;n(window).load(function(){n.getJSON("/streaming-tsne-js/data/wordvecs50dtop1000.json",function(t){t.words=t.words.map(function(t){return{str:t,init:!0}});var o=800;u={words:t.words.slice(0,o),vecs:t.vecs.slice(0,o)},E&&window.console&&window.console.profile&&console.profile("initialization"),console.time("streamingInit"),p.initData(u.vecs),console.timeEnd("streamingInit"),window.console&&window.console.profile&&console.profileEnd(),c(),E&&window.console&&window.console.profile&&console.profile("step"),requestAnimationFrame(w),n("#addPoints").click(function(){v=100,u.words=u.words.map(function(t){return t.init=!0,t});for(var n=0;n<10;n++){var r=t.words[o];r.init=!1,console.log("adding word",r),p.add(t.vecs[o]),u.words.push(r),o++}e.selectAll(".viewport > svg").remove(),c()})})})}(tsne,$,d3,performance,tsnejs,randomColor);