var tsnejs=tsnejs||{REVISION:"ALPHA"};!function(t){"use strict";function r(t){return t>0?1:t<0?-1:0}var i=function(t,r){if(!t)throw r||"Assertion failed"},s=function(t,r,i){return t.hasOwnProperty(r)?t[r]:i},a=!1,e=0,n=function(){if(a)return a=!1,e;var t=2*Math.random()-1,r=2*Math.random()-1,i=t*t+r*r;if(0==i||i>1)return n();var s=Math.sqrt(-2*Math.log(i)/i);return e=r*s,a=!0,t*s},o=function(t,r){return t+n()*r},h=function(t){if("undefined"==typeof t||isNaN(t))return[];if("undefined"==typeof ArrayBuffer){for(var r=new Array(t),i=0;i<t;i++)r[i]=0;return r}return new Float64Array(t)},f=function(t,r,i){for(var s="undefined"!=typeof i,a=[],e=0;e<t;e++){for(var n=[],h=0;h<r;h++)s?n.push(i):n.push(o(0,1e-4));a.push(n)}return a},u=function(t,r){for(var i=t.length,s=0,a=0;a<i;a++){var e=t[a],n=r[a];s+=(e-n)*(e-n)}return s},v=function(t){for(var r=t.length,i=h(r*r),s=0;s<r;s++)for(var a=s+1;a<r;a++){var e=u(t[s],t[a]);i[s*r+a]=e,i[a*r+s]=e}return i},d=function(t,r,s){var a=Math.sqrt(t.length),e=Math.floor(a);i(e===a,"D should have square number of elements.");for(var n=Math.log(r),o=h(e*e),f=h(e),u=0;u<e;u++){for(var v=-(1/0),d=1/0,c=1,l=!1,p=50,m=0;!l;){for(var y=0,g=0;g<e;g++){var Y=Math.exp(-t[u*e+g]*c);u===g&&(Y=0),f[g]=Y,y+=Y}for(var M=0,g=0;g<e;g++){if(0==y)var Y=0;else var Y=f[g]/y;f[g]=Y,Y>1e-7&&(M-=Y*Math.log(Y))}M>n?(v=c,d===1/0?c*=2:c=(c+d)/2):(d=c,v===-(1/0)?c/=2:c=(c+v)/2),m++,Math.abs(M-n)<s&&(l=!0),m>=p&&(l=!0)}for(var g=0;g<e;g++)o[u*e+g]=f[g]}for(var N=h(e*e),x=2*e,u=0;u<e;u++)for(var g=0;g<e;g++)N[u*e+g]=Math.max((o[u*e+g]+o[g*e+u])/x,1e-100);return N},c=function(t){var t=t||{};this.perplexity=s(t,"perplexity",30),this.dim=s(t,"dim",2),this.epsilon=s(t,"epsilon",10),this.iter=0};c.prototype={initDataRaw:function(t){var r=t.length,s=t[0].length;i(r>0," X is empty? You must have some data!"),i(s>0," X[0] is empty? Where is the data?");var a=v(t);this.P=d(a,this.perplexity,1e-4),this.N=r,this.initSolution()},initDataDist:function(t){var r=t.length;i(r>0," X is empty? You must have some data!");for(var s=h(r*r),a=0;a<r;a++)for(var e=a+1;e<r;e++){var n=t[a][e];s[a*r+e]=n,s[e*r+a]=n}this.P=d(s,this.perplexity,1e-4),this.N=r,this.initSolution()},initSolution:function(){this.Y=f(this.N,this.dim),this.gains=f(this.N,this.dim,1),this.ystep=f(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var t=this.N,i=this.costGrad(this.Y),s=i.cost,a=i.grad,e=h(this.dim),n=0;n<t;n++)for(var o=0;o<this.dim;o++){var f=a[n][o],u=this.ystep[n][o],v=this.gains[n][o],d=r(f)===r(u)?.8*v:v+.2;d<.01&&(d=.01),this.gains[n][o]=d;var c=this.iter<250?.5:.8,l=c*u-this.epsilon*d*a[n][o];this.ystep[n][o]=l,this.Y[n][o]+=l,e[o]+=this.Y[n][o]}for(var n=0;n<t;n++)for(var o=0;o<this.dim;o++)this.Y[n][o]-=e[o]/t;return s},debugGrad:function(){for(var t=this.N,r=this.costGrad(this.Y),i=(r.cost,r.grad),s=1e-5,a=0;a<t;a++)for(var e=0;e<this.dim;e++){var n=this.Y[a][e];this.Y[a][e]=n+s;var o=this.costGrad(this.Y);this.Y[a][e]=n-s;var h=this.costGrad(this.Y),f=i[a][e],u=(o.cost-h.cost)/(2*s);console.log(a+","+e+": gradcheck analytic: "+f+" vs. numerical: "+u),this.Y[a][e]=n}},costGrad:function(t){for(var r=this.N,i=this.dim,s=this.P,a=this.iter<100?4:1,e=h(r*r),n=0,o=0;o<r;o++)for(var f=o+1;f<r;f++){for(var u=0,v=0;v<i;v++){var d=t[o][v]-t[f][v];u+=d*d}var c=1/(1+u);e[o*r+f]=c,e[f*r+o]=c,n+=2*c}for(var l=r*r,p=h(l),m=0;m<l;m++)p[m]=Math.max(e[m]/n,1e-100);for(var y=0,g=[],o=0;o<r;o++){for(var Y=new Array(i),v=0;v<i;v++)Y[v]=0;for(var f=0;f<r;f++){y+=-s[o*r+f]*Math.log(p[o*r+f]);for(var M=4*(a*s[o*r+f]-p[o*r+f])*e[o*r+f],v=0;v<i;v++)Y[v]+=M*(t[o][v]-t[f][v])}g.push(Y)}return{cost:y,grad:g}}},t.tSNE=c}(tsnejs),function(t){"use strict";"undefined"==typeof module||"undefined"==typeof module.exports?window.tsnejs=t:module.exports=t}(tsnejs);